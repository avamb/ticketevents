# WooCommerce Integration for Bil24 Connector

–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É WooCommerce –∏ –±–∏–ª–µ—Ç–∏–Ω–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π Bil24, –≤–∫–ª—é—á–∞—é—â–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–æ–¥—É–∫—Ç–æ–≤, –∑–∞–∫–∞–∑–æ–≤, –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É ACF –ø–æ–ª–µ–π.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Å–æ–±—ã—Ç–∏–π Bil24 –∫–∞–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ WooCommerce
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω–æ–π**: –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, —Ç–∞–π–º–µ—Ä –∏—Å—Ç–µ—á–µ–Ω–∏—è
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤**: –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É WooCommerce –∏ Bil24
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –∏ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ PDF –±–∏–ª–µ—Ç–æ–≤ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- **ACF –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ–±—ã—Ç–∏–π, –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –∑–∞–∫–∞–∑–æ–≤

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤**: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ (15 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∏–ª–µ—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ email
- **Webhook –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Bil24
- **GDPR —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ**: –≠–∫—Å–ø–æ—Ä—Ç –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —á–µ—Ä–µ–∑ WordPress i18n

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- WordPress 6.2+
- WooCommerce 7.0+
- PHP 8.0+
- Advanced Custom Fields (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –ê–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç Bil24 —Å API –¥–æ—Å—Ç—É–ø–æ–º

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

1. **–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ WooCommerce –∞–∫—Ç–∏–≤–µ–Ω**
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ API –∫–ª—é—á–∏ Bil24** –≤ `–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Bil24 Connector`
3. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤** `WooCommerce ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Bil24`
4. **–í–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```php
// –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
'bil24_auto_sync_products' => 'yes'
'bil24_auto_sync_orders' => 'yes'
'bil24_auto_sync_customers' => 'yes'

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è
'bil24_reservation_timeout' => '15' // –º–∏–Ω—É—Ç—ã

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∏–ª–µ—Ç–æ–≤
'bil24_auto_generate_tickets' => 'yes'
'bil24_email_tickets' => 'yes'
```

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–º–ø–æ—Ä—Ç —Å–æ–±—ã—Ç–∏–π –∫–∞–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç
–°–æ–±—ã—Ç–∏—è Bil24 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –ø—Ä–æ–¥—É–∫—Ç—ã WooCommerce –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:

```php
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∏–º–ø–æ—Ä—Ç–∞
add_action('bil24_sync_products', function() {
    $integration = new \Bil24\Integrations\WooCommerce\Integration();
    $product_sync = $integration->get_product_sync();
    $product_sync->import_events_as_products();
});
```

#### –†—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç
```php
$product_sync = new \Bil24\Integrations\WooCommerce\ProductSync();

// –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
$result = $product_sync->import_events_as_products();

// –ò–º–ø–æ—Ä—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
$result = $product_sync->import_events_as_products([
    'date_from' => '2024-01-01',
    'event_type' => 'concert',
    'city' => 'Moscow'
]);
```

### –†–∞–±–æ—Ç–∞ —Å –∫–æ—Ä–∑–∏–Ω–æ–π

#### –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤
–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–∏–ª–µ—Ç–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Bil24:

```php
// –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è
add_filter('bil24_reservation_timeout', function($timeout) {
    return 20; // 20 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 15
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è
add_action('bil24_reservation_expired', function($cart_item_key, $reservation_id) {
    // –ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è
});
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã
```javascript
// Frontend JavaScript –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
jQuery('#add-to-cart').on('click', function(e) {
    e.preventDefault();
    
    var productId = jQuery(this).data('product-id');
    var quantity = jQuery('input[name="quantity"]').val();
    
    jQuery.post(bil24_frontend.ajax_url, {
        action: 'bil24_check_availability',
        product_id: productId,
        quantity: quantity,
        nonce: bil24_frontend.nonce
    }, function(response) {
        if (response.success && response.data.available) {
            // –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
        } else {
            alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∏–ª–µ—Ç–æ–≤');
        }
    });
});
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
```php
// –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
add_filter('bil24_should_sync_order', function($should_sync, $order_id) {
    $order = wc_get_order($order_id);
    
    // –ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã
    if ($order->get_meta('_test_order')) {
        return false;
    }
    
    return $should_sync;
}, 10, 2);
```

#### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è –∑–∞–∫–∞–∑–∞
```php
// –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
add_filter('bil24_order_sync_data', function($data, $order) {
    $data['custom_field'] = $order->get_meta('_custom_field');
    $data['special_notes'] = $order->get_customer_note();
    
    return $data;
}, 10, 2);
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
```php
// –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–∏–ª–µ—Ç–æ–≤
add_action('bil24_before_generate_tickets', function($order_id) {
    // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –±–∏–ª–µ—Ç–æ–≤
});

add_action('bil24_after_generate_tickets', function($order_id, $tickets) {
    // –õ–æ–≥–∏–∫–∞ –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–∏–ª–µ—Ç–æ–≤
    foreach ($tickets as $ticket) {
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ CRM, —Å–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —Ç.–¥.
    }
}, 10, 2);
```

#### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è email —Å –±–∏–ª–µ—Ç–∞–º–∏
```php
// –ò–∑–º–µ–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω email —Å –±–∏–ª–µ—Ç–∞–º–∏
add_filter('bil24_ticket_email_template', function($template, $order, $tickets) {
    // –ö–∞—Å—Ç–æ–º–Ω—ã–π —à–∞–±–ª–æ–Ω
    return 'path/to/custom/template.php';
}, 10, 3);

// –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è
add_filter('bil24_ticket_email_attachments', function($attachments, $order, $tickets) {
    $attachments[] = '/path/to/terms.pdf';
    return $attachments;
}, 10, 3);
```

## üéõÔ∏è ACF –ø–æ–ª—è

### –ü–æ–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (—Å–æ–±—ã—Ç–∏–π)
```php
// –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è —Å–æ–±—ã—Ç–∏–π
$event_fields = [
    'bil24_event_id' => 'ID —Å–æ–±—ã—Ç–∏—è –≤ Bil24',
    'bil24_venue_id' => 'ID –ø–ª–æ—â–∞–¥–∫–∏',
    'event_start_date' => '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Å–æ–±—ã—Ç–∏—è',
    'event_end_date' => '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è',
    'venue_name' => '–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–æ—â–∞–¥–∫–∏',
    'venue_address' => '–ê–¥—Ä–µ—Å –ø–ª–æ—â–∞–¥–∫–∏',
    'age_restrictions' => '–í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è',
    'max_tickets_per_customer' => '–ú–∞–∫—Å–∏–º—É–º –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞'
];

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —à–∞–±–ª–æ–Ω–∞—Ö
$start_date = get_field('event_start_date', $product_id);
$venue = get_field('venue_name', $product_id);
```

### –ü–æ–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
```php
// –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
$customer_fields = [
    'preferred_venues' => '–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ –ø–ª–æ—â–∞–¥–∫–∏',
    'event_preferences' => '–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π',
    'communication_preferences' => '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π',
    'bil24_loyalty_points' => '–ë–æ–Ω—É—Å–Ω—ã–µ –±–∞–ª–ª—ã',
    'bil24_vip_status' => 'VIP —Å—Ç–∞—Ç—É—Å'
];

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞
$user_id = get_current_user_id();
$preferred_venues = get_field('preferred_venues', 'user_' . $user_id);
$event_prefs = get_field('event_preferences', 'user_' . $user_id);
```

### –ü–æ–ª—è –∑–∞–∫–∞–∑–æ–≤
```php
// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ
$order_fields = [
    'bil24_order_id' => 'ID –∑–∞–∫–∞–∑–∞ –≤ Bil24',
    'bil24_tickets_generated' => '–ë–∏–ª–µ—Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã',
    'special_requests' => '–û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è',
    'seating_preference' => '–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ –º–µ—Å—Ç–∞–º'
];
```

## üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: `WooCommerce ‚Üí Bil24 Integration`

#### –í–∫–ª–∞–¥–∫–∏ –ø–∞–Ω–µ–ª–∏:
1. **–û–±–∑–æ—Ä** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–∞—Å—Å–æ–≤–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
3. **–õ–æ–≥–∏** - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
4. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —Å–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### –ò–º–ø–æ—Ä—Ç —Å–æ–±—ã—Ç–∏–π
```bash
# –ß–µ—Ä–µ–∑ WP-CLI
wp bil24 import events --date-from=2024-01-01 --limit=50

# –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ
$product_sync = new \Bil24\Integrations\WooCommerce\ProductSync();
$result = $product_sync->import_events_as_products([
    'limit' => 50,
    'date_from' => '2024-01-01'
]);
```

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤
```php
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
$orders = wc_get_orders([
    'status' => ['processing', 'completed'],
    'meta_query' => [
        [
            'key' => '_bil24_sync_status',
            'value' => 'pending',
            'compare' => '='
        ]
    ]
]);

$order_sync = new \Bil24\Integrations\WooCommerce\OrderSync();
foreach ($orders as $order) {
    try {
        $order_sync->sync_order_to_bil24($order->get_id());
    } catch (Exception $e) {
        error_log('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–∞: ' . $e->getMessage());
    }
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```php
$integration = new \Bil24\Integrations\WooCommerce\Integration();
$stats = $integration->get_integration_stats();

echo "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤: " . $stats['synced_products'];
echo "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤: " . $stats['synced_orders'];
echo "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: " . $stats['synced_customers'];
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```php
// –í wp-config.php
define('BIL24_LOG_LEVEL', 'debug');
define('BIL24_LOG_FILE', '/path/to/custom/log/file.log');

// –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
add_filter('bil24_log_level', function() {
    return 'info'; // error, warning, info, debug
});
```

## üîå Webhooks

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhooks –≤ Bil24
1. –í –∞–¥–º–∏–Ω–∫–µ Bil24 –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª API ‚Üí Webhooks
2. –î–æ–±–∞–≤—å—Ç–µ URL: `https://yoursite.com/wp-json/bil24/v1/webhook`
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ webhook secret –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–ª–∞–≥–∏–Ω–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook —Å–æ–±—ã—Ç–∏–π
```php
// –ö–∞—Å—Ç–æ–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook —Å–æ–±—ã—Ç–∏–π
add_action('bil24_webhook_received', function($event_type, $data) {
    switch ($event_type) {
        case 'event.updated':
            // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
            break;
        case 'order.payment_completed':
            // –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç—ã
            break;
        case 'ticket.scanned':
            // –û—Ç–º–µ—Ç–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–ª–µ—Ç–∞
            break;
    }
}, 10, 2);
```

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–±—ã—Ç–∏–∏
```php
// –í single-product.php
if (function_exists('bil24_display_event_info')) {
    bil24_display_event_info();
}

// –ò–ª–∏ —á–µ—Ä–µ–∑ —Ö—É–∫
add_action('woocommerce_single_product_summary', function() {
    global $product;
    
    $bil24_id = get_post_meta($product->get_id(), '_bil24_event_id', true);
    if ($bil24_id) {
        $start_date = get_field('event_start_date', $product->get_id());
        $venue = get_field('venue_name', $product->get_id());
        
        echo '<div class="event-info">';
        if ($start_date) {
            echo '<p><strong>–î–∞—Ç–∞:</strong> ' . date('d.m.Y H:i', strtotime($start_date)) . '</p>';
        }
        if ($venue) {
            echo '<p><strong>–ú–µ—Å—Ç–æ:</strong> ' . esc_html($venue) . '</p>';
        }
        echo '</div>';
    }
}, 25);
```

### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã
```php
// –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
add_filter('woocommerce_get_item_data', function($item_data, $cart_item) {
    $product_id = $cart_item['product_id'];
    $bil24_id = get_post_meta($product_id, '_bil24_event_id', true);
    
    if ($bil24_id) {
        $reservations = WC()->session->get('bil24_reservations', []);
        $cart_item_key = $cart_item['key'];
        
        if (isset($reservations[$cart_item_key])) {
            $expires_at = $reservations[$cart_item_key]['expires_at'];
            $time_left = $expires_at - time();
            
            if ($time_left > 0) {
                $minutes_left = ceil($time_left / 60);
                $item_data[] = [
                    'key' => '–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ',
                    'value' => "–î–µ–π—Å—Ç–≤—É–µ—Ç –µ—â–µ {$minutes_left} –º–∏–Ω."
                ];
            }
        }
    }
    
    return $item_data;
}, 10, 2);
```

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–∫–∫–∞—É–Ω—Ç–∞
```php
// –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–ú–æ–∏ –±–∏–ª–µ—Ç—ã"
add_action('woocommerce_account_dashboard', function() {
    $customer_id = get_current_user_id();
    
    // –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã —Å –±–∏–ª–µ—Ç–∞–º–∏
    $orders = wc_get_orders([
        'customer' => $customer_id,
        'status' => 'completed',
        'meta_query' => [
            [
                'key' => '_bil24_tickets_generated',
                'value' => 'yes',
                'compare' => '='
            ]
        ]
    ]);
    
    if (!empty($orders)) {
        echo '<h3>–ú–æ–∏ –±–∏–ª–µ—Ç—ã</h3>';
        foreach ($orders as $order) {
            $tickets = get_post_meta($order->get_id(), '_bil24_tickets', true);
            if (!empty($tickets)) {
                echo '<div class="my-tickets">';
                echo '<h4>–ó–∞–∫–∞–∑ #' . $order->get_order_number() . '</h4>';
                foreach ($tickets as $ticket) {
                    echo '<p>–ë–∏–ª–µ—Ç #' . $ticket['id'];
                    if (!empty($ticket['qr_code'])) {
                        echo ' <a href="' . $ticket['qr_code'] . '" target="_blank">QR –∫–æ–¥</a>';
                    }
                    echo '</p>';
                }
                echo '</div>';
            }
        }
    }
});
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ GDPR

### –≠–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```php
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
// –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –≠–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

// –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞
add_filter('bil24_export_customer_data', function($data, $user_id) {
    // –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
    $data['custom_field'] = get_user_meta($user_id, 'custom_field', true);
    return $data;
}, 10, 2);
```

### –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```php
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
// –î–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

// –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è
add_action('bil24_erase_customer_data', function($user_id) {
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    delete_user_meta($user_id, 'custom_field');
});
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```php
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Å—Å–∏–π
if (!WC()->session) {
    // –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Å—Å–∏—è–º–∏ WooCommerce
}

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
$client = new \Bil24\Api\Client();
if (!$client->test_connection()) {
    // –ü—Ä–æ–±–ª–µ–º–∞ —Å API
}
```

#### –ë–∏–ª–µ—Ç—ã –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
```php
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
$order = wc_get_order($order_id);
if ($order->get_status() !== 'completed') {
    // –ó–∞–∫–∞–∑ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ "completed"
}

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å Bil24
$bil24_order_id = get_post_meta($order_id, '_bil24_order_id', true);
if (!$bil24_order_id) {
    // –ó–∞–∫–∞–∑ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å Bil24
}
```

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```php
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
$auto_sync = get_option('bil24_auto_sync_products');
if ($auto_sync !== 'yes') {
    // –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞
}

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron –∑–∞–¥–∞—á–∏
$next_run = wp_next_scheduled('bil24_sync_cron');
if (!$next_run) {
    // Cron –∑–∞–¥–∞—á–∏ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
    wp_schedule_event(time(), 'hourly', 'bil24_sync_cron');
}
```

### –û—Ç–ª–∞–¥–∫–∞

#### –í–∫–ª—é—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```php
// –í wp-config.php
define('BIL24_DEBUG', true);
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);

// –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f wp-content/debug.log | grep bil24
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∑–∞–ø—Ä–æ—Å–æ–≤
```php
// –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
add_action('http_api_debug', function($response, $context, $class, $parsed_args, $url) {
    if (strpos($url, 'bil24') !== false) {
        error_log('Bil24 API Request: ' . print_r([
            'url' => $url,
            'args' => $parsed_args,
            'response' => $response
        ], true));
    }
}, 10, 5);
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

#### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```php
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
add_filter('bil24_cache_timeout', function($timeout, $cache_key) {
    if (strpos($cache_key, 'availability') !== false) {
        return 60; // 1 –º–∏–Ω—É—Ç–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∏–ª–µ—Ç–æ–≤
    }
    return $timeout;
}, 10, 2);

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
do_action('bil24_clear_cache');
```

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
```php
// –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
add_filter('bil24_sync_batch_size', function($size) {
    return 10; // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ 10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞ —Ä–∞–∑
});

// –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
add_action('bil24_queue_sync_job', function($job_type, $item_id) {
    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Action Scheduler –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ—á–µ—Ä–µ–¥–µ–π
    as_schedule_single_action(time() + 60, 'bil24_process_sync_job', [
        'type' => $job_type,
        'id' => $item_id
    ]);
});
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```php
// –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
function bil24_migrate_existing_products() {
    $products = get_posts([
        'post_type' => 'product',
        'posts_per_page' => -1,
        'meta_query' => [
            [
                'key' => '_bil24_event_id',
                'compare' => 'NOT EXISTS'
            ]
        ]
    ]);
    
    foreach ($products as $product) {
        // –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤—è–∑–∏ —Å Bil24
        // –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –¥—Ä—É–≥–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
    }
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö
```php
// –•—É–∫ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞
register_activation_hook(__FILE__, function() {
    $current_version = get_option('bil24_woocommerce_version');
    
    if (version_compare($current_version, '1.1.0', '<')) {
        // –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –≤–µ—Ä—Å–∏—é 1.1.0
        bil24_migrate_to_v1_1_0();
    }
    
    update_option('bil24_woocommerce_version', BIL24_VERSION);
});
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫" –≤—ã—à–µ
2. –í–∫–ª—é—á–∏—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É Bil24
4. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–ª–∞–≥–∏–Ω–∞

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –¥–ª—è –≤–µ—Ä—Å–∏–∏ –ø–ª–∞–≥–∏–Ω–∞ 1.0.0 –∏ –≤—ã—à–µ. 